# NFLY
通用被动消息接口服务端

# 分部件概览
- 用户管理
- 通知接口
- 传输协议
- token 更新算法
- worker pool
- asynchronous 调度
- 推送健康度检查
- 通用插件实现
- 推动测试
- 服务端 safeguards
- cli 接口
- gui 接口

## 用户管理
- 用户组
- 用户权限
- 用户注册 (密码使用md5或其他算法取摘要存储)
- 用户登录
- 批量管理
- 用户限制
- 用户屏蔽
- 客户端绑定

## 通知接口
被动式数据接口
- 通用型
- 特定型

## 传输协议
- TCP
- TCP-based 自研协议

## token 更新算法流程
1. 登录API
2. 向服务端请求token (根据通知关联)
3. 服务端生成token 定义session过期period
4. 返回token

### worker
worker作为automatic task执行器，具有状态、无状态，有创建或关闭通知的权限。使用worker需要调用插件，并配置相关参数。

## worker 池

### worker pool
作为woker的容器，队列可配置为有序或无序。

## async 调度
根据特殊算法以获取相关调度值，默认使用woker健康度与插件优先级。
一般情况只批量执行worker pool，也可单独执行某pool中的worker。

## 推送健康度检查
检测通知的可连通性，稳定性，客户端回应延迟等，并根据相关算法得出健康度。

## 通用插件实现
通过重写插件类方法实现。
### 插件结构定义字段
- 名称
- 描述
- 版本号
- 维护者
- 网站
- OTA地址
- 能力标签
- 优先级
### 插件结构定义重写方法
- 注册插件
- 初始化
- 互通 channel
- 作用域
- 读取配置
- 插件调用前
- 插件调用
- 请求更新推送
- 插件调用后
- 插件权限申请
- 插件终止前
### 流程
1. 导入插件到指定位置
2. 插件绑定到worker
3. worker运行
4. 调用插件
5. 插件推送消息
6. 计划任务
7. 停止

## 推送测试
发送pingpong，测试与被动链接的客户端是否通信正常。

## safeguards
- 蜜罐
- 抗重放 （时间戳）
- 验证token
- 写数据库
- 屏蔽

## cli接口
- 服务端控制

## gui接口
- 可视化服务端控制
- 被动客户端
